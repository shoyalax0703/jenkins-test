pipeline {
    agent any

    stages {
        stage('Test kubectl with Plugin') {
            steps {
                withKubeConfig(credentialsId: 'kind', 
                               caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EZ3hNVEV3TkRreE9Wb1hEVE16TURnd09ERXdORGt4T1Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSzAxClJYcGh4QVFqV0NldVNDVXNyOS85eEVZSitMcTE4UzVLUzhUQURQQ2k1d0FBMjh0SkRLU1BMUC8rUG14czEwTUMKbFpLak9RcFkrVmhRWUNTenIyRkk0bjZNOSsyVnBaUWhhKzEwNk50NkxIK2ZnaUgvZkQ4VFd2dFFXU0JTWHRLbgpOeFJiSTZ0VllCNkN3SHVXVUsvekhkYkJnemZkN09RaFNCZXAvUWFjNHI3TnB5VG1pZmVYVFJNdTU3Vi83eE1PCjIwOW1XTGpQZ0JBdUNOSGluY2N2QW1KS2p2YnVuY3FPdTUxV2NzL09TWHRLQ3RqR2Vaa1ZwRERiWlpQUFFOV1kKeDRIdytYZFFXY0pNTVhXN1dOWTJnVmhjTXVET1EyMDQ3QjA0S2FhRlRqWmdleFFaVU5WZzYwVnlsaEkwY0c2SAo1dFBCQ1YwK2xldVdHdldwVE0wQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZJMmdrYlFhSVVTSFZMMzhYaUtHR1Z2UDJFRWNNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFBQm9MbkxDeDZWcGFoT2tKQ3pQcUFFTkNVN1hXelNhcXlCMWRRTDdRdzk1c0hBdHhrVQozT2wzVFRUS3hncjZiRStCazJIdnNLaUtVa3k0aVlqanRTakZQNmZVZ1lXZCs5dGFYZjQ5dlNkeEZSRXVUdzRPCjdPc0MzVERnRTgyTGZUZ0Q5dGhKMFJsTkNabUpkWE1USXNENzNrWlpwSFVuTU5xd2dnaW9CWVJJOWFvZnZTY28KUFRpSm9Pd3VDSmMwS1ZoRzhxNDFTbWEzcitLUThXdkZJQzJObTZTQktlVDFDMWNOVE9FbFYvM0hURFMrdjZ2RwpubmpPeUNISzlpOHppL3dVQkV3STJ1NjlIL1ppOHRNc3dmVGYrbEY2VnBLb3o4a29wWUp1d2N6c28xMU15c0kyCk5KUDBwU1dYdldyMm5pNkpWaUNpSjVseGxpWit0bnVOMGszTAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==', 
                               serverUrl: 'https://127.0.0.1:54178') {
                    sh 'kubectl get nodes'
                }
            }
        }
    }
}